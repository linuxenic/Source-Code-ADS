var showTerminal,isFreshing=true;Ext.onReady(function(){Ext.QuickTips.init();var a=new Date();a.setHours(23,59,59);var c=new Date();c.setDate(c.getDate()-1);c.setHours(0,0,0);var q=new Date();q.setDate(q.getDate()-1);q.setHours(23,59,59);var k=new Date();k.setHours(0,0,0);var h,i,f;var d="check";var n=function(t){var z=t.getFullYear();var r=t.getMonth()+1;r=r<10?("0"+r):r;var x=t.getDate();x=x<10?("0"+x):x;var v=t.getHours();var w=t.getMinutes();w=w<10?("0"+w):w;var u=t.getSeconds();u=u<10?("0"+u):u;return z+"-"+r+"-"+x+" "+v+":"+w+":"+u};var m=Ext.create("Ext.data.Store",{fields:["sid","storeName"],autoLoad:true,proxy:{type:"ajax",url:"terminal!selStoreList.action",reader:{type:"json",root:"data",tiemout:20000,totalProperty:"totalCount"}},listeners:{load:function(){this.loadData([{sid:-1,storeName:""+getIi18NText("allstore")+""}],true)}}});tabStore=Ext.create("Ext.data.Store",{fields:["sid","sname","orNum","toMon"],buffered:false,pageSize:20,proxy:{type:"ajax",url:"statistics!exportStoreStatData.action",timeout:1800000,reader:{type:"json",root:"data",timeout:300000,totalProperty:"totalCount"}},autoLoad:false,listeners:{load:function(s,r){Ext.getBody().unmask()}}});function e(s){isFreshing=false;var t=Ext.getCmp("allStore_combo").getValue();i=Ext.getCmp("btime").getValue();f=Ext.getCmp("etime").getValue();if(i>f&&f){Ext.example.msg(getIi18NText("operationTips"),'<font color="red">'+getIi18NText("programTip04")+"</font>");return}var r=(f-i)/(1000*60*60*24);if(r>360){Ext.example.msg(getIi18NText("operationTips"),'<font color="red">'+getIi18NText("operationRangeTips")+"</font>");return}tabStore.load({params:{st:Ext.getCmp("allStore_combo").getValue(),b:Ext.Date.format(Ext.getCmp("btime").getValue(),dateFormat),e:Ext.Date.format(Ext.getCmp("etime").getValue(),dateFormat)},callback:function(v,u,w){if(w==false){isFreshing=false;alert(getIi18NText("monitor_error_01"));return}isFreshing=true}})}h=Ext.create("Ext.container.Viewport",{layout:"border",renderTo:document.body,border:false,items:[{region:"north",height:40,width:400,id:"northContanier",layout:{type:"hbox",align:"middle",defaultMargins:{right:3}},bodyCls:"x_panel_backDD",items:[{xtype:"combo",fieldLabel:getIi18NText("storeName"),labelWidth:80,labelAlign:"left",id:"allStore_combo",width:200,editable:false,store:m,margin:"0 0 0 10",queryMode:"local",displayField:"storeName",valueField:"sid",value:-1},{xtype:"datefield",fieldLabel:getIi18NText("time"),hidden:false,format:dateFormat,labelWidth:50,width:270,id:"btime",name:"btime",emptyText:getIi18NText("startTime"),value:k},{xtype:"datefield",id:"etime",hidden:false,format:dateFormat,width:180,emptyText:getIi18NText("endTime"),value:a,listeners:{select:function(s){var r=s.getValue();r.setHours(23,59,59);s.setValue(r)}}},{xtype:"button",id:"queryBut",text:window.top.getIi18NText("selectAndRefresh"),handler:e}]},{region:"center",border:false,layout:"fit",listeners:{afterrender:l}}]});e();function l(r,s){gridPanel=Ext.create("Ext.grid.Panel",{frame:false,store:tabStore,columns:{items:[{text:getIi18NText("No"),width:50,xtype:"rownumberer",align:"center"},{text:getIi18NText("storeName"),dataIndex:"sname",flex:2,align:"center",renderer:g},{text:getIi18NText("numOrder"),dataIndex:"orNum",minWidth:200,flex:2,align:"center"},{text:getIi18NText("total_income"),dataIndex:"toMon",align:"center",flex:2,renderer:p}],defaults:{menuDisabled:true,sortable:false}},bbar:[Ext.create("Ext.PagingToolbar",{id:"padingBar",store:tabStore,displayInfo:true,border:false,displayMsg:getIi18NText("jsp_paging"),emptyMsg:getIi18NText("jsp_nodata")})],margin:1,viewConfig:{trackOver:false,disableSelection:false,emptyText:'<h1 style="margin:10px">'+window.top.getIi18NText("roleTip05")+"</h1>"}});r.add(gridPanel)}function j(s){var u=confirm(getIi18NText("exitWaraming01"));return u}function o(r){if(parent&&parent.addTabManFn){parent.addTabManFn({id:"tid_"+r.id+r.b+r.e,title:getIi18NText("storeInfo")+"("+r.tname+")",iconCls:"createIconCss",closable:true,closeText:window.top.getIi18NText("cancelModify"),listeners:{beforeclose:j},html:'<iframe frameborder="0" width="100%" height="100%" src="statistics!showStoreStatistics.action?tid='+r.id+"&&tname="+r.tname+"&&b="+n(i)+"&&e="+n(f)+'"></iframe>',border:false})}}showTerminal=function(v,x,w){var u=gridPanel.getStore().getAt(v);if(u){var t=u.get("sid");var s=u.get("sname");if(x=="W"){o({id:t,tname:s,b:Ext.Date.format(i,"YmdHis"),e:Ext.Date.format(f,"YmdHis")})}}};function p(v,t,s,u,r){return'<font color="green"> ï¿¥ </font>'+Ext.String.htmlEncode(v)}function g(v,t,s,u,r){return Ext.String.format('<a href="javascript: showTerminal('+u+",'W');\">{0}</a>",Ext.String.htmlEncode(v))}function b(u,t,r,s){if(r==1){Ext.getCmp("allStore_combo").hide().getEl().fadeOut()}else{if(r==2){Ext.getCmp("allCompany_combo").hide().getEl().fadeOut()}else{if(r==3){}}}if(t==1){Ext.getCmp("allStore_combo").show().getEl().fadeIn()}else{if(t==2){Ext.getCmp("allCompany_combo").show().getEl().fadeIn()}else{if(t==3){}}}}});