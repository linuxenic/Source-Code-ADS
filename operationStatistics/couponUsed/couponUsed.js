Ext.onReady(function(){Ext.QuickTips.init();var i,h,b,d,l,e;var c=Ext.create("Ext.tip.ToolTip",{title:window.top.getIi18NText("systemMessage"),minWidth:100,html:""});function f(m,n){c.update(n);c.showBy(m,null,[50,-60]);m.addListener("mouseout",function(){c.hide()})}d={text:window.top.getIi18NText("operation"),minWidth:110,maxWidth:130,menuText:window.top.getIi18NText("operation"),menuDisabled:true,hidden:true,sortable:false,draggable:false,resizable:false,xtype:"actioncolumn",items:[]};if(true){d.items.push({iconCls:"removeIconCss",tooltip:window.top.getIi18NText("delete"),handler:j});d.hidden=false}i=Ext.create("Ext.container.Viewport",{layout:"border",renderTo:Ext.getBody(),border:false,style:"background:white",items:[{region:"north",height:40,width:400,id:"northContanier",layout:{type:"hbox",align:"middle",defaultMargins:{right:3}},bodyCls:"x_panel_backDD",items:[{xtype:"image",src:"",width:40,height:24,imgCls:"searchIconCss"},{fieldLabel:window.top.getIi18NText("name"),id:"searchTextId",xtype:"textfield",maxLength:50,width:250,labelWidth:30,emptyText:window.top.getIi18NText("searchByCoupon1"),enforceMaxLength:true},{xtype:"datefield",fieldLabel:window.top.getIi18NText("beCreatedTimne"),labelWidth:80,width:260,id:"btime",name:"btime",emptyText:window.top.getIi18NText("startTime"),format:dateFormat},{xtype:"datefield",name:"etime",id:"etime",width:180,emptyText:window.top.getIi18NText("endTime"),format:dateFormat},{xtype:"button",id:"queryBut",iconCls:"queryIconCss",text:window.top.getIi18NText("select"),handler:g}]},{region:"center",border:false,layout:"fit",listeners:{render:k}}]});function k(m,n){b=Ext.create("Ext.data.Store",{fields:["id","title","tradeNo","money","createTime","sname"],buffered:false,autoLoad:true,pageSize:10,leadingBufferZone:50,proxy:{type:"ajax",url:"statistics!getCouponUsed.action",extraParams:{search:"",b:"",e:""},reader:{type:"json",root:"data",tiemout:30000,totalProperty:"totalCount"}},listeners:{}});h=Ext.create("Ext.grid.Panel",{title:window.top.getIi18NText("couponUsedList"),iconCls:"tabIconCss",frame:false,store:b,frame:false,border:false,forceFit:true,columns:{items:[{text:window.top.getIi18NText("Noo"),width:60,xtype:"rownumberer",align:"center"},{text:window.top.getIi18NText("Noo"),dataIndex:"id",hidden:true},{text:window.top.getIi18NText("name"),dataIndex:"title",minWidth:250},{text:window.top.getIi18NText("orders14"),dataIndex:"tradeNo",minWidth:120},{text:window.top.getIi18NText("couponMoney"),dataIndex:"money",minWidth:80},{text:window.top.getIi18NText("storeName"),dataIndex:"sname",minWidth:80},{text:window.top.getIi18NText("createTime"),dataIndex:"createTime",minWidth:140,renderer:a},d],defaults:{menuDisabled:true,sortable:false,draggable:false,align:"center"}},bbar:[{id:"padingBar",xtype:"pagingtoolbar",store:b,border:false,displayInfo:true}],margin:1,tools:[{xtype:"button",text:window.top.getIi18NText("refresh"),border:false,iconCls:"refreshIconCss",handler:g}],viewConfig:{trackOver:false,disableSelection:false,emptyText:'<h1 style="margin:10px">'+window.top.getIi18NText("roleTip05")+"</h1>"}});m.add(h)}function g(m){var n=Ext.getCmp("btime");if(!n.isValid()){f(m,window.top.getIi18NText("startTimeErr"));return}var o=Ext.getCmp("etime");if(!o.isValid()){f(m,window.top.getIi18NText("endTimeErr"));return}if(!Ext.isEmpty(o.getValue())&&!Ext.isEmpty(n.getValue())){if(n.getValue()>o.getValue()){f(m,window.top.getIi18NText("timesErrWarming"));return}}b.getProxy().extraParams.search=encode(Ext.getCmp("searchTextId").getValue());b.getProxy().extraParams.b=Ext.Date.format(n.getValue(),dateFormat);b.getProxy().extraParams.e=Ext.Date.format(o.getValue(),dateFormat);b.loadPage(1)}function j(n,p,t,o,q,m,s){Ext.Msg.show({icon:Ext.MessageBox.QUESTION,title:window.top.getIi18NText("systemMessage"),cls:"msgCls",msg:window.top.getIi18NText("deleteChoose"),animateTarget:s,plain:true,buttons:Ext.MessageBox.OKCANCEL,buttonText:{ok:getIi18NText("delete"),cancel:getIi18NText("cancel")},fn:function(r,v,u){if(r=="ok"){Ext.getBody().mask(getIi18NText("deling"));Ext.Ajax.request({url:"source!deleteCouponUsed.action",params:{id:m.get("id")},method:"post",callback:function(y,z,x){var w=showResult(z,x);Ext.getBody().unmask();if(w==false){return}g();Ext.example.msg(window.top.getIi18NText("operationTips"),window.top.getIi18NText("deleteFileSuccess"))}})}}})}function a(m){return Ext.Date.format(new Date(m),dateFormat)}});