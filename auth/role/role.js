var defaultSelect,showTip,queryFun,AUTH;Ext.onReady(function(){var g,f,m="grid_row_",e,k;AUTH=Ext.merge({add:false,update:false,"delete":false,admin:false,roles:[],comp:[]},Ext.decode(decode(AUTH_TBAR)));var b=Ext.create("Ext.tip.ToolTip",{title:window.top.getIi18NText("systemMessage"),minWidth:100,html:""});Ext.QuickTips.init();var c={text:window.top.getIi18NText("operation"),width:80,menuText:window.top.getIi18NText("operation"),menuDisabled:true,sortable:false,draggable:false,resizable:false,xtype:"actioncolumn",items:[]};if(AUTH.update){c.items.push({iconCls:"editIconCss",tooltip:window.top.getIi18NText("modify"),handler:l});c.hidden=false}if(AUTH["delete"]){c.items.push({iconCls:"removeIconCss",tooltip:window.top.getIi18NText("delete"),handler:h});c.hidden=false}g=Ext.create("Ext.container.Viewport",{layout:{type:"border"},renderTo:document.body,defaults:{},border:false,style:"background: white",items:[{region:"north",height:40,width:400,id:"northContanier",layout:{type:"hbox",align:"middle",defaultMargins:{right:3}},cls:"shadowBackCls",items:[{xtype:"image",src:"",width:40,height:24,imgCls:"searchIconCss"},{fieldLabel:window.top.getIi18NText("name"),id:"searchTextId",xtype:"textfield",maxLength:50,width:180,labelWidth:30,emptyText:window.top.getIi18NText("selectByRoleName"),enforceMaxLength:true},{xtype:"datefield",fieldLabel:window.top.getIi18NText("beCreatedTimne"),name:"btime",labelWidth:80,width:260,id:"btime",name:"btime",emptyText:window.top.getIi18NText("startTime"),format:dateFormat},{xtype:"datefield",name:"etime",id:"etime",width:180,emptyText:window.top.getIi18NText("endTime"),format:dateFormat},{xtype:"button",id:"queryBut",iconCls:"queryIconCss",text:window.top.getIi18NText("select"),handler:function(){queryFun(this)}}]},{region:"center",border:false,layout:"fit",listeners:{render:i}}]});function i(n,o){k=getAjaxProxy({url:"auth!allRoles.action",extraParams:{r:1}});tabStore=Ext.create("Ext.data.Store",{fields:["id","name","author","createUser","updateDate","remark"],buffered:false,pageSize:20,leadingBufferZone:50,proxy:k,sorters:[{property:"updateDate",direction:"DESC"}],autoLoad:true,listeners:{load:function(p){Ext.getCmp("totalUserTabRows").setValue(p.getTotalCount());Ext.getBody().unmask()}}});f=Ext.create("Ext.grid.Panel",{title:window.top.getIi18NText("rolesList"),iconCls:"tabIconCss",frame:false,store:tabStore,columns:[{text:window.top.getIi18NText("No"),width:60,xtype:"rownumberer",align:"center"},{text:window.top.getIi18NText("roleName"),dataIndex:"name",minWidth:100,flex:1},{text:window.top.getIi18NText("createUser"),dataIndex:"createUser",minWidth:150},{text:window.top.getIi18NText("lastUpdateTime"),dataIndex:"updateDate",width:140,renderer:a},{text:window.top.getIi18NText("remarks"),dataIndex:"remark",flex:1,minWidth:100},c],bbar:[{id:"padingBar",xtype:"pagingtoolbar",store:tabStore,border:false,displayInfo:true}],margin:1,tools:[{xtype:"displayfield",id:"totalUserTabRows",fieldLabel:window.top.getIi18NText("countOfRole"),labelWidth:70,labelStyle:"color: white",fieldStyle:"color: white",minWidth:100,value:"-"},{xtype:"button",tooltip:window.top.getIi18NText("addrole"),tooltipType:"title",text:window.top.getIi18NText("addrole"),border:false,iconCls:"addIconCss",margin:"0 5 0 0",hidden:!AUTH.add,handler:openAddroleWindowow},{xtype:"button",tooltip:window.top.getIi18NText("roleTip04"),tooltipType:"title",text:window.top.getIi18NText("refresh"),border:false,iconCls:"refreshIconCss",handler:function(){queryFun()}}],viewConfig:{trackOver:false,disableSelection:false,emptyText:'<h1 style="margin:10px">'+window.top.getIi18NText("roleTip05")+"</h1>"}});n.add(f)}function j(n){return/^(\d+)(\*)(\d+)$/.test(n)?true:n+window.top.getIi18NText("roleTip06")}function a(s,p,o,t,r,q,n){return Ext.Date.format(new Date(s),dateFormat)}function l(o,q,u,p,s,n,t){openAddroleWindowow(t,n.get("id"))}function h(o,q,u,p,s,n,t){Ext.Msg.show({icon:Ext.MessageBox.QUESTION,title:window.top.getIi18NText("systemMessage"),cls:"msgCls",msg:window.top.getIi18NText("deleteRoleWarming","<font color=red>"+n.get("name")+"</font>"),animateTarget:t,plain:true,buttons:Ext.MessageBox.OKCANCEL,buttonText:{ok:window.top.getIi18NText("delete"),cancel:window.top.getIi18NText("cancel")},fn:function(r,w,v){if(r=="ok"){f.getEl().mask(window.top.getIi18NText("deletingRole"));Ext.Ajax.request({url:"auth!deleteRole.action",params:{i:n.get("id")},method:"post",callback:function(z,A,y){f.getEl().unmask();var x=showResult(A,y);if(x==false){return}Ext.example.msg(window.top.getIi18NText("operationTips"),window.top.getIi18NText("deleteRoleSuccessTip"));queryFun()}})}}})}queryFun=function(n){var o=Ext.getCmp("btime");if(!o.isValid()){d(n,window.top.getIi18NText("startTimeErr"));return}var p=Ext.getCmp("etime");if(!p.isValid()){d(n,window.top.getIi18NText("endTimeErr"));return}if(!Ext.isEmpty(p.getValue())&&!Ext.isEmpty(o.getValue())){if(o.getValue()>p.getValue()){d(n,window.top.getIi18NText("timesErrWarming"));return}}k.setExtraParam("n",encode(Ext.getCmp("searchTextId").getValue()));k.setExtraParam("b",Ext.Date.format(o.getValue(),dateFormat));k.setExtraParam("e",Ext.Date.format(p.getValue(),dateFormat));f.getSelectionModel().deselectAll();tabStore.loadPage(1)};function d(n,o){b.update(o);b.showBy(n,null,[50,-60]);n.addListener("mouseout",function(){b.hide()})}});