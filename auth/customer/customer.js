var defaultSelect;var iconArray;var AUTH;var konka_phone;var isEng;var konka_ip;var adVersion=(localVersion=="AD");var isazld;var selectId;var tempId;var datastore;var refreshTree;var sonUid=[];var uid;var userType;var sonUserId;var userMenuClickType;var njkz=(local=="njkz");Ext.onReady(function(){var n,k,s="grid_row_",f={},a=[];var m=Ext.merge({add:false,update:false,"delete":false,type:false,bind:false,aloneAssign:false,modify:false},Ext.decode(decode(AUTH_TBAR)));var b=Ext.create("Ext.tip.ToolTip",{title:window.top.getIi18NText("systemMessage"),minWidth:100,html:""});Ext.QuickTips.init();function h(){datastore=Ext.create("Ext.data.TreeStore",{autoLoad:false,proxy:{type:"ajax",url:"auth!getChildUsersGroup.action",reader:{type:"json",timeout:120000}},root:{expanded:true,autoLoad:true},listeners:{load:function(t){Ext.getCmp("buttonRefresh").enable()}}})}Ext.Ajax.request({url:"auth!getSingleUser.action",params:{id:new Date().getTime(),i:0},method:"post",callback:function(v,w,u){var t=showResult(w,u);if(t==false){return}f=t;h();p()}});sonUserId=function(){Ext.Ajax.request({url:"auth!getAllSonUserId.action",method:"post",callback:function(v,x,u){var t=showResult(x,u);if(t==false){return}var w=t.SonUserIds;sonUid=w.split(",")}})};sonUserId();Ext.Ajax.request({url:"auth!getLoginId.action",method:"post",callback:function(v,w,u){var t=showResult(w,u);if(t==false){return}uid=t.loginId}});function d(){n.getEl().mask(window.top.getIi18NText("dataProcessing"));Ext.Ajax.request({url:"auth!getSingleUser.action",params:{id:new Date().getTime(),i:0},method:"post",callback:function(v,w,u){var t=showResult(w,u);if(t==false){return}n.getEl().unmask();f=t;Ext.getCmp("src").setSrc(f.src);Ext.getCmp("name").setValue(f.name);Ext.getCmp("uname").setValue(f.uname);Ext.getCmp("role").setValue(f.role);Ext.getCmp("email").setText(f.email);Ext.getCmp("author").setText(f.author);Ext.getCmp("acAu").setText(f.acAu+window.top.getIi18NText("traceNum")+" / "+f.tacAu+window.top.getIi18NText("totalNum"));Ext.getCmp("siAu").setText(f.siAu+window.top.getIi18NText("traceNum")+" / "+f.tsiAu+window.top.getIi18NText("totalNum"));Ext.getCmp("tel").setText(f.tel);Ext.getCmp("mark").setValue(f.mark);if(f.auNutype==2){Ext.getCmp("acAu").show();Ext.getCmp("acAu1").show();Ext.getCmp("shareAu").hide();Ext.getCmp("shareAu1").hide();Ext.getCmp("siAu").show();Ext.getCmp("siAu1").show()}else{Ext.getCmp("acAu").hide();Ext.getCmp("acAu1").hide();Ext.getCmp("shareAu").show();Ext.getCmp("shareAu1").show();Ext.getCmp("siAu").hide();Ext.getCmp("siAu1").hide()}if(f.capacityStatus){if(f.uct==2){Ext.getCmp("selfCapacity").show();Ext.getCmp("capacityConfig").show();Ext.getCmp("capacityConfig").setText(f.ufc+"("+window.top.getIi18NText("usedCapacity")+":MB) / "+f.utc+"("+window.top.getIi18NText("totalCapacity")+":MB)");Ext.getCmp("sharedCapacity").hide();Ext.getCmp("capacityConfig1").hide()}else{Ext.getCmp("selfCapacity").hide();Ext.getCmp("capacityConfig").hide();Ext.getCmp("sharedCapacity").show();Ext.getCmp("capacityConfig1").show()}}else{Ext.getCmp("selfCapacity").hide();Ext.getCmp("sharedCapacity").hide();Ext.getCmp("capacityConfig1").hide();Ext.getCmp("capacityConfig").hide()}}})}function p(){n=Ext.create("Ext.container.Viewport",{layout:"border",renderTo:document.body,border:false,baseCls:"x_panel_backDD",items:[{region:"west",flex:6,layout:{type:"hbox",align:"middle",pack:"center"},border:false,bodyStyle:"background: transparent",items:[{xtype:"panel",layout:{type:"vbox",align:"center"},height:"100%",border:false,bodyStyle:"background: transparent",items:[{xtype:"panel",id:"upanel",border:false,bodyStyle:"background: transparent",width:400,margin:"5px 0 0 0",layout:{type:"table",columns:2,tableAttrs:{width:"100%",height:"100%"}},autoScroll:false,items:[{xtype:"image",id:"src",src:f.src,width:97,height:97,rowspan:3,tdAttrs:{align:"right"}},{xtype:"displayfield",id:"name",fieldLabel:window.top.getIi18NText("nickname"),labelWidth:60,labelCls:"labelCls_1",fieldCls:"labelValueCls",value:f.name},{xtype:"displayfield",id:"uname",fieldLabel:window.top.getIi18NText("username"),labelWidth:60,labelCls:"labelCls_1",fieldCls:"labelValueCls",value:f.uname},{xtype:"displayfield",id:"role",fieldLabel:window.top.getIi18NText("role"),labelWidth:60,labelCls:"labelCls_1",fieldCls:"labelValueCls",value:j(f.role)},{xtype:"button",text:'<font class="linkButTxtCls">'+window.top.getIi18NText("refresh")+"</font>",style:"background:transparent",border:false,tdAttrs:{align:"left"},colspan:(version_xm||!m.modify)?2:1,handler:d},{xtype:"button",text:'<font class="linkButTxtCls">'+window.top.getIi18NText("changePassword")+"</font>",style:"background:transparent",border:false,hidden:version_xm||!m.modify,tdAttrs:{align:"right"},handler:c},{xtype:"component",width:"100%",margin:"5px 0 0 0",style:"border-bottom: 1px solid orange;",colspan:2},{xtype:"component",html:"&nbsp;",height:"100%",width:"100%",style:"border-right: 1px solid orange;text-align: right;padding:5px;margin:0px 1px;"},{xtype:"button",text:'<font class="linkButTxtCls">&nbsp</font>',style:"background: transparent",border:false,hidden:false,tdAttrs:{align:"right"}},{xtype:"component",html:window.top.getIi18NText("jsp_qrlogin_wechatlogin"),height:"100%",width:"100%",hidden:!m.wqrlogin||njkz,baseCls:"labelCls"},{xtype:"button",text:window.top.getIi18NText("jsp_qrlogin_shwoqr"),margin:"0 0 0 3",id:"qr_btn",border:false,hidden:!m.wqrlogin||njkz,tdAttrs:{style:"border-bottom: 1px dashed lightgray;border-left: 1px solid orange;"},handler:o},{xtype:"component",html:window.top.getIi18NText("Tel"),height:"100%",width:"100%",baseCls:"labelCls"},{xtype:"label",id:"tel",padding:4,baseCls:"labelValueCls",tdAttrs:{style:"border-bottom: 1px dashed lightgray;border-left: 1px solid orange;"},text:f.tel},{xtype:"component",html:window.top.getIi18NText("email"),height:"100%",width:"100%",hidden:true,baseCls:"labelCls"},{xtype:"label",id:"email",padding:4,hidden:true,baseCls:"labelValueCls",tdAttrs:{style:"border-bottom: 1px dashed lightgray;border-left: 1px solid orange;"},text:f.email},{xtype:"component",html:window.top.getIi18NText("creator"),height:"100%",width:"100%",baseCls:"labelCls"},{xtype:"label",id:"author",padding:4,baseCls:"labelValueCls",tdAttrs:{style:"border-bottom: 1px dashed lightgray;border-left: 1px solid orange;"},text:f.author},{xtype:"component",html:window.top.getIi18NText("activePoints"),id:"acAu1",height:"100%",width:"100%",hidden:false,baseCls:"labelCls"},{xtype:"label",id:"acAu",padding:4,baseCls:"labelValueCls",hidden:false,tdAttrs:{style:"border-bottom: 1px dashed lightgray;border-left: 1px solid orange;"},text:f.acAu+window.top.getIi18NText("traceNum")+" / "+f.tacAu+window.top.getIi18NText("totalNum")},{xtype:"component",html:window.top.getIi18NText("simPoints"),id:"siAu1",height:"100%",hidden:false,width:"100%",baseCls:"labelCls"},{xtype:"label",id:"siAu",padding:4,baseCls:"labelValueCls",hidden:false,tdAttrs:{style:"border-bottom: 1px dashed lightgray;border-left: 1px solid orange;"},text:f.siAu+window.top.getIi18NText("traceNum")+" / "+f.tsiAu+window.top.getIi18NText("totalNum")},{xtype:"component",html:getIi18NText("shareduth"),height:"100%",id:"shareAu",hidden:false,width:"100%",baseCls:"labelCls"},{xtype:"label",id:"shareAu1",padding:4,baseCls:"labelValueCls",hidden:false,tdAttrs:{style:"border-bottom: 1px dashed lightgray;border-left: 1px solid orange;"},text:""},{xtype:"component",html:window.top.getIi18NText("selfCapacity"),id:"selfCapacity",height:"100%",width:"100%",hidden:true,baseCls:"labelCls"},{xtype:"label",id:"capacityConfig",padding:4,baseCls:"labelValueCls",hidden:true,style:"border-bottom: 1px dashed lightgray;border-left: 1px solid orange;",text:f.ufc+"("+window.top.getIi18NText("usedCapacity")+":MB) / "+f.utc+"("+window.top.getIi18NText("totalCapacity")+":MB)"},{xtype:"component",html:window.top.getIi18NText("sharedCapacity"),id:"sharedCapacity",height:"100%",width:"100%",hidden:true,baseCls:"labelCls"},{xtype:"label",id:"capacityConfig1",padding:4,baseCls:"labelValueCls",hidden:true,style:"border-bottom: 1px dashed lightgray;border-left: 1px solid orange;",text:""},{xtype:"component",html:window.top.getIi18NText("remarks"),height:"200",width:"100%",baseCls:"labelCls"},{xtype:"textarea",id:"mark",baseCls:"labelValueCls",fieldBodyCls:"textareaCls",style:"border-left: 1px solid orange;",readOnly:true,width:280,height:150,value:f.mark}]}]}]},{region:"center",border:false,layout:"fit",flex:3,items:[{xtype:"treepanel",id:"customerTreepanel",title:window.top.getIi18NText("childUsersList"),store:datastore,bodyStyle:"background: #F7F7F7",height:390,plain:false,margin:"20 0 20 0",iconCls:"tabIconCss",rootVisible:false,leaf:true,tools:[{xtype:"button",tooltip:window.top.getIi18NText("refresh"),id:"buttonRefresh",tooltipType:"title",text:window.top.getIi18NText("refresh"),border:false,iconCls:"refreshIconCss",margin:"0 5 0 0",handler:refreshTree}],listeners:{itemcontextmenu:function(u,t,x,v,y,w){y.preventDefault();y.stopEvent();currIndex=v;selectId=t.get("id");Ext.Ajax.request({url:"auth!getUserType.action",method:"post",params:{selectId:selectId},success:function(z){userType=z.responseText}});l.showAt(y.getXY());if(sonUid.indexOf(selectId)==-1||uid==selectId){Ext.getCmp("updateUser1").hide();Ext.getCmp("addUser1").show()}else{Ext.getCmp("updateUser1").show();Ext.getCmp("addUser1").show()}}}}]},{region:"east",border:false,bodyStyle:"background: transparent",flex:1}],listeners:{afterrender:function(){Ext.getCmp("acAu").setText(f.acAu+window.top.getIi18NText("traceNum")+" / "+f.tacAu+window.top.getIi18NText("totalNum"));Ext.getCmp("siAu").setText(f.siAu+window.top.getIi18NText("traceNum")+" / "+f.tsiAu+window.top.getIi18NText("totalNum"));if(f.auNutype==2){Ext.getCmp("acAu").show();Ext.getCmp("acAu1").show();Ext.getCmp("shareAu").hide();Ext.getCmp("shareAu1").hide();Ext.getCmp("siAu").show();Ext.getCmp("siAu1").show()}else{Ext.getCmp("acAu").hide();Ext.getCmp("acAu1").hide();Ext.getCmp("shareAu").show();Ext.getCmp("shareAu1").show();Ext.getCmp("siAu").hide();Ext.getCmp("siAu1").hide()}if(f.capacityStatus){if(f.uct==2){Ext.getCmp("selfCapacity").show();Ext.getCmp("capacityConfig").show();Ext.getCmp("capacityConfig").setText(f.ufc+"("+window.top.getIi18NText("usedCapacity")+":MB) / "+f.utc+"("+window.top.getIi18NText("totalCapacity")+":MB)");Ext.getCmp("sharedCapacity").hide();Ext.getCmp("capacityConfig1").hide()}else{Ext.getCmp("selfCapacity").hide();Ext.getCmp("capacityConfig").hide();Ext.getCmp("sharedCapacity").show();Ext.getCmp("capacityConfig1").show()}}else{Ext.getCmp("selfCapacity").hide();Ext.getCmp("sharedCapacity").hide();Ext.getCmp("capacityConfig1").hide();Ext.getCmp("capacityConfig").hide()}}}})}var l=new Ext.menu.Menu({bodyStyle:"background: #F7F7F7",items:[{text:getIi18NText("modifyUser"),id:"updateUser1",hidden:true,handler:function(t){userMenuClickType="update";e(t,selectId)}},{text:getIi18NText("adduser"),id:"addUser1",hidden:true,handler:function(t){userMenuClickType="add";e(t,selectId)}}]});iconArray=[{name:"interface_designer.png",src:"images/user/interface_designer.png"},{name:"device_manager.png",src:"images/user/device_manager.png"},{name:"replenishment.png",src:"images/user/replenishment.png"},{name:"default.png",src:"images/user/default.png"},{name:"head.png",src:"images/user/head.png"},{name:"yellow1.png",src:"images/user/yellow1.png"},{name:"yellow2.png",src:"images/user/yellow2.png"}];konka_phone=(adVersion&&local=="noads_konka"&&m.konka_phone);isEng=window.top.getIi18NText("confirm")=="OK";konka_ip=(adVersion&&local=="noads_konka"&&m.konka_ip);isazld=(azldcenter=="azldcenter");function e(t,u){openAddUserWindow(t,u)}refreshTree=function(){Ext.getCmp("buttonRefresh").disable();sonUserId();datastore.reload()};function q(y,v,u,z,x,w,t){return Ext.String.format('<img src="{0}" width="50px" height="50px"/>',y)}function i(z,u,w,x,B,A,y){var v=w.get("name");var t=w.get("role");return"<div><span class='labelCls_10'>"+window.top.getIi18NText("nickname")+"：</span><span class='labelValueCls_10' title='"+v+"'>"+Ext.String.ellipsis(v,10)+"</span><br/><br/><span class='labelCls_10'>"+window.top.getIi18NText("role")+"：</span><span class='labelValueCls_10' title='"+t+"'>"+Ext.String.ellipsis(t,10)+"</span></div>"}function j(t){return"<span class='labelValueCls_10' title='"+t+"'>"+Ext.String.ellipsis(t,20)+"</span>"}function c(u){var v=window.top.modifyPasswordFn;if(v){v(u)}}function r(t,u){b.update(u);b.showBy(t,null,[50,-60]);t.addListener("mouseout",function(){b.hide()})}var g;function o(){if(g!=null){g.show("qr_btn");return}Ext.Ajax.request({url:"qrlogin!bindqrimage.action",method:"get",callback:function(w,x,v){var t=Ext.decode(v.responseText);if(t.code==0){var u=t.msg+"?i="+new Date().getTime();g=Ext.create("Ext.Window",{title:window.top.getIi18NText("jsp_qrlogin_scanbind"),width:310,height:340,headerPosition:"bottom",layout:"fit",closeAction:"hide",modal:true,html:'<div style="background:url('+u+') no-repeat scroll 0 0 transparent;; width:300; height: 300px;"></div>',border:false}).show("qr_btn")}else{if(t.code==3){alert(window.top.getIi18NText("jsp_qrlogin_reqwxfail"))}else{alert(window.top.getIi18NText("jsp_qrlogin_reqqrfail"))}}}})}});