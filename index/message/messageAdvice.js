var addTabManFn,nowTabName,removeMessage,unreadMessage,unReadAll;var chooseType=0,changeStatus;Ext.onReady(function(){var h;var c,m,f;window.setTimeout(function(){a()},500);Ext.QuickTips.init();var b=new Ext.util.MixedCollection();var d=Ext.create("Ext.selection.CheckboxModel",{listeners:{select:k,deselect:i}});function i(o,n){if(b.containsKey(n.get("id"))){b.removeAtKey(n.get("id"))}}function k(o,n){if(!b.contains(n.get("id"))){b.add(n.get("id"),n)}}var e=(getIi18NText("confirm")=="OK")?"30%":"22%";var j=(getIi18NText("confirm")=="OK")?"70%":"78%";function a(){viewport=Ext.create("Ext.container.Viewport",{layout:{type:"border"},renderTo:document.body,defaults:{},bodyStyle:"background:#f6fafd",border:false,style:"background: #f6fafd",items:[{xtype:"panel",region:"west",id:"leftPanel",layout:"vbox",split:false,bodyStyle:"background:#f6fafd",border:false,width:e,overflowX:"auto",overflowY:"auto",autoScroll:true,defaults:{margin:"6 0 0 0"},shadow:false,defaults:{border:false},height:"100%",items:Ext.decode(decode(AUTH_TBAR))},{region:"west",border:false,height:"100%",width:j,layout:"fit",listeners:{render:r,handler:function(w,v,u){viewport.doLayout()}}}]});function r(x,y){m=getAjaxProxy({url:"message!getAllMessageInfo.action",extraParams:{}});c=Ext.create("Ext.data.Store",{fields:["id","context","type","state","creater","createtime","remark"],buffered:false,pageSize:15,leadingBufferZone:50,proxy:m,autoLoad:false,listeners:{load:function(z){Ext.getBody().unmask()}}});f=Ext.create("Ext.grid.Panel",{region:"west",width:"80%",shadow:false,height:"100%",store:c,selType:"checkboxmodel",selModel:d,columns:[{text:window.top.getIi18NText("No"),width:60,xtype:"rownumberer",align:"center"},{text:window.top.getIi18NText("message17"),dataIndex:"context",minWidth:50,flex:1,renderer:q},{text:window.top.getIi18NText("message18"),dataIndex:"state",minWidth:50,maxWidth:150,renderer:s},{text:window.top.getIi18NText("creator"),dataIndex:"creater",minWidth:50,maxWidth:100},{text:window.top.getIi18NText("time"),dataIndex:"createtime",minWidth:50,maxWidth:150,flex:1},{text:getIi18NText("operation"),dataIndex:"status",minWidth:110,menuText:getIi18NText("operation"),sortable:false,resizable:false,renderer:p}],bbar:[{id:"padingBar",bodyStyle:"background:#f6fafd",xtype:"pagingtoolbar",store:c,border:false,displayInfo:true}],tbar:[{text:"sss",hidden:true},"->",{xtype:"button",iconCls:"detailIconCss",text:window.top.getIi18NText("message23"),margin:5,handler:n},{xtype:"button",iconCls:"removeIconCss",text:window.top.getIi18NText("delete"),margin:5,handler:t},{xtype:"button",iconCls:"refreshIconCss",text:window.top.getIi18NText("refresh"),margin:5,handler:o}],viewConfig:{trackOver:false,disableSelection:false,emptyText:'<h1 style="margin:10px">'+window.top.getIi18NText("notData")+"</h1>"},listeners:{itemdblclick:function(A,z,D,B,E,C){l(B,null,D)}}});x.add(f);parent.messageUpdateLeft=h;var w=777;var v=Ext.getCmp("leftPanel");var u=[];Ext.each(v.items.items,function(B,A,C){var z=$("#"+B.getId()).find("a");Ext.each(z,function(E,D,F){u.push(E.id);$("#"+E.id).removeClass("x-a-change")})});if(u.length>0){w=u[0];$("#"+w).addClass("x-a-change");w=w.substring(7,w.length);m.setExtraParam("t",w);c.loadPage(1)}}function p(z,w,v,y,u){var x=['<ul class="ctrlULCls">'];x.push('<li><a href="javascript:removeMessage('+y+",'M');\" title=\""+getIi18NText("delete")+'"><span class="removeIconCss"></span> </a></li>');x.push('<li><a href="javascript:unreadMessage('+y+",'M');\" title=\""+getIi18NText("message20")+'"><span class="editIconCss"></span> </a></li>');x.push('<li><a href="javascript:detailMessage('+y+",'M');\" title=\""+getIi18NText("item_detail")+'"><span class="detailIconCss"></span> </a></li>');x.push("</ul>");return x.join("")}function s(y,w,v,x,u){if(y==1||y==3){return'<font color="green">'+window.top.getIi18NText("message21")+"</font>"}else{if(y==2){return'<font color="purple">'+window.top.getIi18NText("message22")+"</font>"}}}function q(z,w,v,y,u){try{var A=Ext.decode(z);return window.top.getMsgIi18NText(A)}catch(x){return z}}changeStatus=function(u){var w=$(u);var u=w.attr("id");chooseType=u.substring(7,u.length);var v=w.parent().parent().parent().parent().parent().find("a[id*='a_tool_']");if(v!=null){v.each(function(x,y){$(y).removeClass("x-a-change")})}w.addClass("x-a-change");m.setExtraParam("t",chooseType);f.getSelectionModel().deselectAll();c.loadPage(1);b.clear()};function n(v,y,u){var x=new Array();Ext.each(b.items,function(B,A,z){x.push(B.get("id"))});var w=x.join(",");if(Ext.isEmpty(w)){Ext.example.msg(getIi18NText("systemMessage"),getIi18NText("deletesMsg"));return}if(w){Ext.Msg.show({icon:Ext.MessageBox.QUESTION,title:window.top.getIi18NText("systemMessage"),cls:"msgCls",msg:getIi18NText("confirm")+getIi18NText("message23")+"?",animateTarget:u,plain:true,buttons:Ext.MessageBox.OKCANCEL,buttonText:{ok:window.top.getIi18NText("confirm"),cancel:window.top.getIi18NText("cancel")},fn:function(z,B,A){if(z=="ok"){f.getEl().mask(window.top.getIi18NText("monitor_message_33"));Ext.Ajax.request({url:"message!readAllMessage.action",params:{mids:w},method:"post",callback:function(E,F,D){f.getEl().unmask();var C=showResult(F,D);if(C==false){return}Ext.example.msg(window.top.getIi18NText("operationTips"),window.top.getIi18NText("message23")+window.top.getIi18NText("success")+"!");h(Ext.decode(C.msg));o();b.clear()}})}}})}}function t(v,y,u){var x=new Array();Ext.each(b.items,function(B,A,z){x.push(B.get("id"))});var w=x.join(",");if(Ext.isEmpty(w)){Ext.example.msg(getIi18NText("systemMessage"),getIi18NText("deletesMsg"));return}if(w){Ext.Msg.show({icon:Ext.MessageBox.QUESTION,title:window.top.getIi18NText("systemMessage"),cls:"msgCls",msg:window.top.getIi18NText("confirm_del",getIi18NText("message")),animateTarget:u,plain:true,buttons:Ext.MessageBox.OKCANCEL,buttonText:{ok:window.top.getIi18NText("delete"),cancel:window.top.getIi18NText("cancel")},fn:function(z,B,A){if(z=="ok"){f.getEl().mask(window.top.getIi18NText("deling"));Ext.Ajax.request({url:"message!deleteMessage.action",params:{mids:w},method:"post",callback:function(E,F,D){f.getEl().unmask();var C=showResult(F,D);if(C==false){return}Ext.example.msg(window.top.getIi18NText("operationTips"),window.top.getIi18NText("message26"));h(Ext.decode(C.msg));o();b.clear()}})}}})}}removeMessage=function(w,y,v){var u=c.getAt(w);if(u){var x=u.get("id");Ext.Msg.show({icon:Ext.MessageBox.QUESTION,title:window.top.getIi18NText("systemMessage"),cls:"msgCls",msg:window.top.getIi18NText("message24"),animateTarget:v,plain:true,buttons:Ext.MessageBox.OKCANCEL,buttonText:{ok:window.top.getIi18NText("delete"),cancel:window.top.getIi18NText("cancel")},fn:function(z,B,A){if(z=="ok"){f.getEl().mask(window.top.getIi18NText("deling"));Ext.Ajax.request({url:"message!deleteMessage.action",params:{mids:x},method:"post",callback:function(E,F,D){f.getEl().unmask();var C=showResult(F,D);if(C==false){return}Ext.example.msg(window.top.getIi18NText("operationTips"),window.top.getIi18NText("message26"));h(Ext.decode(C.msg));o();b.clear()}})}}})}};unreadMessage=function(w,y,v){var u=c.getAt(w);if(u){var x=u.get("id");if(x){f.getEl().mask(window.top.getIi18NText("monitor_message_33"));Ext.Ajax.request({url:"message!unReadMessage.action",params:{mid:x},method:"post",callback:function(B,C,A){f.getEl().unmask();var z=showResult(C,A);if(z==false){return}Ext.example.msg(window.top.getIi18NText("operationTips"),window.top.getIi18NText("message20")+window.top.getIi18NText("success")+"!");h(Ext.decode(z.msg));o()}})}}};detailMessage=function(v,w,u){l(v,w,u)};function o(){c.loadPage(1)}}var g=Ext.create("Ext.panel.Panel",{listeners:{afterRender:function(){}},baseCls:"x_panel_backDD",width:"100%",height:400,layout:{type:"vbox"},defaults:{xtype:"displayfield",margin:"10 0 0 20",fieldBodyCls:"fieldBodyCls2",labelWidth:60},items:[{fieldLabel:window.top.getIi18NText("message"),name:"context",id:"context",xtype:"textareafield",anchor:"100%",minWidth:250,minHeight:100,margin:"10 0 0 20"},{xtype:"displayfield",labelAlign:"right",minWidth:350,id:"creator",fieldLabel:getIi18NText("creator")},{xtype:"displayfield",labelAlign:"right",minWidth:350,id:"state",fieldLabel:getIi18NText("status")},{xtype:"displayfield",labelAlign:"right",minWidth:350,id:"time",fieldLabel:getIi18NText("time")},{xtype:"displayfield",labelAlign:"right",minWidth:350,id:"remark",fieldLabel:getIi18NText("remark")}]});var l=function(n,x,q){viewport.mask();var w=Ext.getBody();var s={width:300,height:300};if(!Ext.getCmp("detailMessageWin")){var y=function(){viewport.unmask()};s=Ext.create("Ext.window.Window",{id:"detailMessageWin",title:getIi18NText("message16"),closable:true,closeAction:"hide",resizable:false,listeners:{beforeclose:y},draggable:true,shadow:false,animCollapse:true,x:(w.getWidth()-s.width)/2,y:(w.getHeight()-s.height)/2,width:s.width,height:s.height,items:[g]})}Ext.getCmp("detailMessageWin").show(q);var u=c.getAt(n);var o="";try{var v=Ext.decode(u.get("context"));o=getMsgIi18NText(v)}catch(t){o=u.get("context")}Ext.getCmp("context").setValue(o);Ext.getCmp("creator").setValue(u.get("creater"));Ext.getCmp("time").setValue(u.get("createtime"));var p;if(u.get("state")==1||u.get("state")==3){p=getIi18NText("message21")}else{if(u.get("state")==2){p=getIi18NText("message22")}}Ext.getCmp("state").setValue(p);Ext.getCmp("remark").setValue(u.get("remark"))};h=function(p){var r;for(var n=700;n<720;n++){r="b_tool_"+n;var q=$("#"+r);if(q!=null&&"undefined"!=typeof q){q.text("");q.removeClass()}}for(var o in p){var q=$("#"+o);if(q!=null&&"undefined"!=typeof q){q.text(p[o]);q.addClass("number")}}};if(parent.openMessageDetail!=0){}});