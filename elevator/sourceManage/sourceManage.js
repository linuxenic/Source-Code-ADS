var defaultSelect,editSourceFn;Ext.onReady(function(){Ext.QuickTips.init();var q,m,w,g,e,o,d;var t=[];var h=window.top.getIi18NText("confirm")=="OK"?true:false;var b=Ext.create("Ext.tip.ToolTip",{title:window.top.getIi18NText("systemMessage"),minWidth:100,html:""});function r(x,y){b.update(y);b.showBy(x,null,[50,-60]);x.addListener("mouseout",function(){b.hide()})}q=Ext.create("Ext.container.Viewport",{layout:"border",renderTo:Ext.getBody(),border:false,style:"background:white",items:[{region:"north",height:40,width:400,id:"northContanier",layout:{type:"hbox",align:"middle",defaultMargins:{right:3}},bodyCls:"x_panel_backDD",items:[{xtype:"image",src:"",width:40,height:24,imgCls:"searchIconCss"},{fieldLabel:window.top.getIi18NText("quipmentNo"),id:"searchterId",xtype:"textfield",maxLength:50,width:200,labelWidth:h==true?60:55,emptyText:window.top.getIi18NText("quipmentNo"),enforceMaxLength:true},{xtype:"datefield",fieldLabel:window.top.getIi18NText("beCreatedTimne"),labelWidth:80,width:260,id:"btime",name:"btime",emptyText:window.top.getIi18NText("startTime"),format:dateFormat},{xtype:"datefield",name:"etime",id:"etime",width:180,emptyText:window.top.getIi18NText("endTime"),format:dateFormat},{xtype:"button",id:"queryBut",iconCls:"queryIconCss",text:window.top.getIi18NText("select"),handler:f}]},{region:"center",border:false,layout:"fit",listeners:{render:k}}]});function k(x,y){w=Ext.create("Ext.data.Store",{fields:["id","terId","terName","ctype","status","areaCode","duration","createTime","content"],buffered:false,autoLoad:true,pageSize:10,leadingBufferZone:50,proxy:{type:"ajax",url:"elevator!getElevatorLists.action",extraParams:{b:"",e:"",terId:""},reader:{type:"json",root:"data",tiemout:30000,totalProperty:"totalCount"}}});m=Ext.create("Ext.grid.Panel",{title:window.top.getIi18NText("sourceList"),iconCls:"tabIconCss",frame:false,store:w,frame:false,border:false,forceFit:true,columns:{items:[{text:window.top.getIi18NText("Noo"),minWidth:60,align:"center",xtype:"rownumberer"},{text:"tsid",dataIndex:"id",hidden:true},{text:window.top.getIi18NText("quipmentNo"),minWidth:75,maxWidth:80,dataIndex:"terId"},{text:window.top.getIi18NText("deviceName"),minWidth:120,maxWidth:130,dataIndex:"terName"},{text:window.top.getIi18NText("contentType"),minWidth:80,maxWidth:100,dataIndex:"ctype",renderer:l},{text:window.top.getIi18NText("status"),minWidth:153,dataIndex:"status",renderer:c},{text:window.top.getIi18NText("areaCode"),minWidth:100,dataIndex:"areaCode"},{text:window.top.getIi18NText("playingStartTime"),minWidth:135,maxWidth:140,dataIndex:"duration",renderer:u},{text:window.top.getIi18NText("remarks"),dataIndex:"content",hidden:true},{text:getIi18NText("operation"),dataIndex:"status",minWidth:h==true?160:135,maxWidth:h==true?160:135,flex:1,menuText:getIi18NText("operation"),sortable:false,renderer:j,align:"center"},{text:window.top.getIi18NText("createTime"),minWidth:140,dataIndex:"createTime",flex:2}],defaults:{menuDisabled:true,sortable:false,draggable:false,align:"center"}},bbar:[{id:"padingBar",xtype:"pagingtoolbar",store:w,border:false,displayInfo:true}],margin:1,tools:[{xtype:"button",text:window.top.getIi18NText("refresh"),border:false,iconCls:"refreshIconCss",handler:f}],viewConfig:{trackOver:false,disableSelection:false,emptyText:'<h1 style="margin:10px">'+window.top.getIi18NText("roleTip05")+"</h1>"}});x.add(m)}function f(x){var z=Ext.getCmp("searchterId").getValue();var y=Ext.getCmp("btime");if(!y.isValid()){r(x,window.top.getIi18NText("startTimeErr"));return}var A=Ext.getCmp("etime");if(!A.isValid()){r(x,window.top.getIi18NText("endTimeErr"));return}if(!Ext.isEmpty(A.getValue())&&!Ext.isEmpty(y.getValue())){if(y.getValue()>A.getValue()){r(x,window.top.getIi18NText("timesErrWarming"));return}}w.getProxy().extraParams.terId=encode(z);w.getProxy().extraParams.b=Ext.Date.format(y.getValue(),dateFormat);w.getProxy().extraParams.e=Ext.Date.format(A.getValue(),dateFormat);w.loadPage(1)}function c(x){if(x==0){return getIi18NText("checkPending")}else{if(x==1){return'<font color="red">'+getIi18NText("auditNotthrough")+"</font>"}else{if(x==2){return'<font color="green">'+getIi18NText("published")+"</font>"}}}}function u(D,x,z,B,E,F,C){var y=$.parseJSON(D);var A=y.b+"<br/>"+getIi18NText("to")+"<br/>"+y.e;return A}function l(x){if(x==1){return getIi18NText("word")}else{if(x==2){return getIi18NText("picture")}else{if(x==3){return getIi18NText("imageText")}}}}function j(D,A,z,C,y){var x=z.get("id");var B=['<ul class="ctrlULCls">'];B.push('<li><span class="editIconCss">&nbsp;</span><a href="javascript:editSourceFn('+C+",'P');\" title=\""+getIi18NText("previewSource")+'">'+getIi18NText("preview")+"</a></li>");if(D==0||D==1){B.push('<li><span class="auditIconCss">&nbsp;</span><a href="javascript:editSourceFn('+C+",'C');\" title=\""+getIi18NText("auditSource")+'">'+getIi18NText("auditProgram")+"</a></li>")}else{if(D==2){B.push('<li><span class="publishedCss">&nbsp;</span><a title="'+getIi18NText("publishedSource")+'">'+getIi18NText("published")+"</a></li>")}}B.push('<li><span class="removeIconCss">&nbsp;</span><a style="margin-top:6px;" href="javascript: editSourceFn('+C+",'D');\" title=\""+getIi18NText("deleteSources")+'">'+getIi18NText("delete")+"</a></li>");B.push("</ul>");return B.join("")}editSourceFn=function(C,A){var z=m.getStore().getAt(C);if(z){var B=z.get("id");var y=z.get("areaCode");var x=z.get("status");if(A=="C"){p(B,y)}else{if(A=="P"){clientWindth=$(window.top).width();clientHeight=$(window.top).height();a(clientWindth,clientHeight,B,y)}else{if(A=="D"){n(B,x)}}}}};function a(x,B,C,A){var z=800;var y=480;Ext.Ajax.request({url:"elevator!getPreviewSource.action",params:{sourceId:C},method:"POST",timeout:60000,callback:function(F,L,H){Ext.getBody().unmask();if(H.timedout==true){Ext.Msg.alert(window.top.getIi18NText("systemMessage"),window.top.getIi18NText("timeout")+"<br/><font color='red'>("+window.top.getIi18NText("dealTimeoutTip01")+")</font>");return}var O;O=Ext.decode(H.responseText);var G=$.parseJSON(O.msg);var E=G.width;var M=G.height;var K=G.value;var I=G.ctype;var J=G.bgImg;var D=1;if(M>(y-40)){D=1-(M-(y-40))/M;M=(y-40);E=(E-10)*D}var N='<div id="imagePre" style="width:100%;height:100%; text-align: center; display: flex;" ><p style="margin:auto;">'+K+"</p></div>";if(I==2){N='<div id="imagePre" style="width:100%;height:100%; display: flex;justify-content: center;align-items: center;" ><img src="'+K+'" style="width:'+E+"px;height:"+M+'px"; /></div>'}else{if(I==3){N='<div id="imagePre" style="width:100%;height:100%;text-align: center;display: flex;  background: url('+J+") no-repeat center;background-size:"+E+"px "+M+'px;" ><p style="margin:auto;">'+K+"</p></div>"}}d=top.Ext.create("Ext.window.Window",{id:"sourcePreviewWindow",title:window.top.getIi18NText("previewSource")+"："+A,frame:false,width:z,height:y,modal:true,cloasable:true,resizable:false,html:N});d.show();if(!O||L==false){Ext.Msg.alert(window.top.getIi18NText("systemMessage"),window.top.getIi18NText("dataError")+"<br/><font color='red'>("+window.top.getIi18NText("dataErrorTip")+")</font>");return}}})}function p(y,x){if(!Ext.isNumber(y)){return}Ext.Msg.show({icon:Ext.MessageBox.QUESTION,title:window.top.getIi18NText("systemMessage"),cls:"msgCls",msg:"<strong>"+window.top.getIi18NText("auditProgram")+"["+x+"]？</strong>",plain:true,minWidth:300,minHeight:120,buttons:Ext.MessageBox.YESNOCANCEL,buttonText:{yes:window.top.getIi18NText("pass"),no:window.top.getIi18NText("notPass"),cancel:window.top.getIi18NText("cancel")},fn:function(z,B,A){if(z=="cancel"){return}m.getEl().mask(window.top.getIi18NText("auditingProgram"));Ext.Ajax.request({url:"elevator!inspectAndPublishSource.action",params:{sid:y,status:z=="yes"?2:1},method:"post",timeout:240000,callback:function(E,F,D){m.getEl().unmask();var C=showResult(F,D);if(C==false){return}Ext.example.msg(window.top.getIi18NText("operationTips"),window.top.getIi18NText("auditComplete")+"</font>");f()}})}})}function n(z,x,y){if(Ext.isEmpty(z)){return}z=z instanceof Array?z.join(","):z;var A=window.top.getIi18NText("removeSource2");if(x==2){A=window.top.getIi18NText("removeSource")}Ext.Msg.show({icon:Ext.MessageBox.QUESTION,title:window.top.getIi18NText("systemMessage"),cls:"msgCls",msg:A,animateTarget:y,plain:true,buttons:Ext.MessageBox.OKCANCEL,buttonText:{ok:window.top.getIi18NText("delete"),cancel:window.top.getIi18NText("cancel")},fn:function(B,D,C){if(B=="ok"){if(y!=null&&y.isComponent){y.disable();m.getEl().mask(window.top.getIi18NText("deletingProgram"))}Ext.Ajax.request({url:"elevator!deleteSource.action",params:{sid:z},method:"post",timeout:240000,callback:function(G,H,F){if(y!=null&&y.isComponent){y.enable()}m.getEl().unmask();var E=showResult(H,F);if(E==false){return}Ext.example.msg(window.top.getIi18NText("operationTips"),window.top.getIi18NText("deleteSuccess")+"</font>");f()}})}}})}function s(x){return Ext.Date.format(new Date(x),dateFormat)}function v(E,x,D,z,B,A,F){var y,C;if(A.get("type")==1){y=getIi18NText("formal");C=2}else{y=getIi18NText("testConnect");C=1}Ext.Msg.show({icon:Ext.MessageBox.QUESTION,title:window.top.getIi18NText("systemMessage"),cls:"msgCls",msg:window.top.getIi18NText("updateToyType","<font color=red>"+y+"</font>"),animateTarget:F,plain:true,buttons:Ext.MessageBox.OKCANCEL,buttonText:{ok:getIi18NText("confirm"),cancel:getIi18NText("cancel")},fn:function(G,I,H){if(G=="ok"){Ext.getBody().mask(getIi18NText("monitor_message_33"));Ext.Ajax.request({url:"livetoy!updateToyType.action",params:{type:C,tid:A.get("id")},method:"post",callback:function(L,M,K){var J=showResult(M,K);Ext.getBody().unmask();if(J==false){return}f();Ext.example.msg(window.top.getIi18NText("operationTips"),window.top.getIi18NText("monitor_message_35"))}})}}})}function i(y,A,D,z,B,x,C){if(x.get("status")==1){Ext.Msg.show({title:getIi18NText("systemMessage"),msg:getIi18NText("toyIsPlaying"),width:250,icon:Ext.Msg.QUESTION,buttons:Ext.Msg.OK,buttonText:{ok:getIi18NText("confirm")}});f();return}openAddToyWin(C,x.get("id"),x)}});