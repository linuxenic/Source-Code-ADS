var showdetail;Ext.onReady(function(){var j,i,h,m;var e=Ext.merge({"delete":false},Ext.decode(decode(AUTH_TBAR)));var a=Ext.create("Ext.tip.ToolTip",{title:window.top.getIi18NText("systemMessage"),minWidth:100,html:""});Ext.QuickTips.init();var d={text:window.top.getIi18NText("operation"),minWidth:100,maxWidth:60,menuText:window.top.getIi18NText("operation"),menuDisabled:true,hidden:true,sortable:false,draggable:false,resizable:false,xtype:"actioncolumn",items:[]};if(e["delete"]){d.items.push({iconCls:"removeIconCss",tooltip:window.top.getIi18NText("delete"),handler:b});d.hidden=false}if(true){d.items.push({iconCls:"showdetailIconCss",tooltip:window.top.getIi18NText("detail"),handler:l});d.hidden=false}j=Ext.create("Ext.container.Viewport",{layout:{type:"border"},renderTo:document.body,defaults:{},border:false,style:"background: white",items:[{region:"north",height:40,width:400,id:"northContanier",layout:{type:"hbox",align:"middle",defaultMargins:{right:3}},bodyCls:"x_panel_backDD",items:[{xtype:"image",src:"",width:40,height:24,imgCls:"searchIconCss"},{fieldLabel:window.top.getIi18NText("type"),labelAlign:"right",xtype:"combobox",store:[[2,window.top.getIi18NText("allType")],[0,window.top.getIi18NText("video")],[1,window.top.getIi18NText("audio")]],value:2,labelWidth:30,width:120,editable:false,queryMode:"local",name:"pstate",maxLength:50,id:"searchtype"},{fieldLabel:window.top.getIi18NText("name"),id:"searchTextId",xtype:"textfield",emptyText:getIi18NText("userorterminal"),maxLength:50,width:180,labelWidth:30},{xtype:"datefield",fieldLabel:window.top.getIi18NText("beCreatedTimne"),name:"btime",labelWidth:80,width:260,id:"btime",name:"btime",emptyText:window.top.getIi18NText("startTime"),format:dateFormat},{xtype:"datefield",name:"etime",id:"etime",width:180,emptyText:window.top.getIi18NText("endTime"),format:dateFormat},{xtype:"button",id:"queryBut",iconCls:"queryIconCss",text:window.top.getIi18NText("select"),handler:g}]},{region:"center",border:false,layout:"fit",listeners:{render:k}}]});function k(n,o){m=getAjaxProxy({url:"terminal!getAllYunHistory.action"});h=Ext.create("Ext.data.Store",{fields:["id","andriodlandid","username","terminalid","name","pictures","audio","time","ttime","type"],buffered:false,pageSize:20,leadingBufferZone:50,proxy:m,listeners:{load:function(p){Ext.getCmp("totalUserTabRows").setValue(p.getTotalCount());Ext.getBody().unmask()}}});h.loadPage(1);i=Ext.create("Ext.grid.Panel",{title:window.top.getIi18NText("videoHistory"),iconCls:"tabIconCss",frame:false,store:h,columns:[{text:window.top.getIi18NText("No"),width:80,xtype:"rownumberer",align:"center"},{text:window.top.getIi18NText("type"),dataIndex:"type",minWidth:100,align:"center",flex:1,renderer:function(u,r,q,v,t,s,p){if(u==0){return window.top.getIi18NText("video")}else{return window.top.getIi18NText("audio")}}},{text:window.top.getIi18NText("createid"),dataIndex:"andriodlandid",minWidth:100,align:"center",hidden:true},{text:window.top.getIi18NText("uploadID"),dataIndex:"username",minWidth:100,align:"center",flex:1},{text:window.top.getIi18NText("terNum"),dataIndex:"terminalid",minWidth:100,align:"center",flex:1,hidden:true},{text:window.top.getIi18NText("terminalName"),dataIndex:"name",minWidth:100,align:"center",flex:1},{text:window.top.getIi18NText("videotime"),dataIndex:"ttime",minWidth:100,align:"center",flex:1},{text:window.top.getIi18NText("picture"),dataIndex:"pictures",minWidth:100,align:"center",flex:1,renderer:function(u,p,q,s,w,v,t){var y=q.get("terminalid");if(u.indexOf(",")>0){var x="images/monitoring/"+y+"/"+u.substr(0,u.indexOf(","))}else{if(u=="none"){var x="images/none.jpg"}else{var x="images/monitoring/"+y+"/"+u}}var r=Ext.String.format('<img src="{0}" width="64px" height="64px" alt="获取失败"/>',x);return r}},{text:window.top.getIi18NText("create_time"),dataIndex:"time",align:"center",width:140},d],bbar:[{id:"padingBar",xtype:"pagingtoolbar",store:h,border:false,displayInfo:true}],margin:1,tools:[{xtype:"displayfield",id:"totalUserTabRows",fieldLabel:window.top.getIi18NText("total"),labelWidth:50,minWidth:90,height:22,value:"-"},{xtype:"button",tooltipType:"title",text:window.top.getIi18NText("refresh"),border:false,iconCls:"refreshIconCss",handler:g}],viewConfig:{trackOver:false,disableSelection:false,emptyText:'<h1 style="margin:10px">'+window.top.getIi18NText("roleTip05")+"</h1>"}});n.add(i)}function g(n){var o=Ext.getCmp("btime");if(!o.isValid()){f(n,window.top.getIi18NText("startTimeErr"));return}var p=Ext.getCmp("etime");if(!p.isValid()){f(n,window.top.getIi18NText("endTimeErr"));return}if(!Ext.isEmpty(p.getValue())&&!Ext.isEmpty(o.getValue())){if(o.getValue()>p.getValue()){f(n,window.top.getIi18NText("timesErrWarming"));return}}m.setExtraParam("info",encode(Ext.getCmp("searchTextId").getValue().trim()));m.setExtraParam("t",Ext.getCmp("searchtype").getValue());m.setExtraParam("b",Ext.Date.format(o.getValue(),dateFormat));m.setExtraParam("e",Ext.Date.format(p.getValue(),dateFormat));h.loadPage(1)}function f(n,o){a.update(o);a.showBy(n,null,[50,-60]);n.addListener("mouseout",function(){a.hide()})}function b(o,q,u,p,s,n,t){Ext.Msg.show({icon:Ext.MessageBox.QUESTION,title:window.top.getIi18NText("systemMessage"),cls:"msgCls",msg:window.top.getIi18NText("delyunhis"),animateTarget:t,plain:true,buttons:Ext.MessageBox.OKCANCEL,buttonText:{ok:getIi18NText("delete"),cancel:getIi18NText("cancel")},fn:function(r,w,v){if(r=="ok"){i.getEl().mask(window.top.getIi18NText("deling"));Ext.Ajax.request({url:"terminal!deleteYunHistory.action",params:{i:n.get("id")},method:"post",success:function(){i.getEl().unmask();Ext.example.msg(window.top.getIi18NText("operationTips"),window.top.getIi18NText("success"));g()}})}}})}function l(u,n,t,p,s,q,x){if(showdetail){Ext.getCmp("anlandid").setValue(window.top.getIi18NText("uploadID")+"："+q.get("username"));Ext.getCmp("terminalid").setValue(window.top.getIi18NText("terminalName")+"："+q.get("name"));Ext.getCmp("time").setValue(window.top.getIi18NText("create_time")+"："+q.get("time"));Ext.getCmp("ttime").setValue(window.top.getIi18NText("videotime")+"："+q.get("ttime"));var o=q.get("pictures");var w=q.get("terminalid");Ext.getCmp("picshow").setValue(c(o,w));showdetail.show();return}showdetail=Ext.create("Ext.window.Window",{title:window.top.getIi18NText("videoHistory"),plain:true,modal:true,border:false,frame:false,modal:true,constrain:true,width:600,height:400,closeAction:"hide",layout:{type:"vbox",defaultMargins:{left:40},pack:"center",align:"middle"},items:[{xtype:"panel",width:"100%",height:350,border:false,bodyStyle:"overflow-x:hidden; overflow-y:scroll;",items:[{xtype:"displayfield",id:"anlandid",value:window.top.getIi18NText("uploadID")+"："+q.get("username")},{xtype:"displayfield",id:"terminalid",value:window.top.getIi18NText("terminalName")+"："+q.get("name")},{xtype:"displayfield",id:"time",value:window.top.getIi18NText("create_time")+"："+q.get("time")},{xtype:"displayfield",id:"ttime",value:window.top.getIi18NText("videotime")+"："+q.get("ttime")},{xtype:"displayfield",width:"100%",id:"picshow",value:c(q.get("pictures"),q.get("terminalid"))}]}]}).show()}function c(n,q){var t=n;var q=q;if(t=="none"){return"<ul class='deul'><li><img src='images/none.jpg' heigth='500px'></li></ul>"}var o=t.split(",");var p="<ul class='deul'>";var u="images/monitoring/"+q+"/";for(var s=0;s<o.length-1;s++){var r="<li><img src='"+u+o[s]+"' heigth='500px'></li>";p+=r}p+="</ul>";return p}});