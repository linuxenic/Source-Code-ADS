Ext.onReady(function(){Ext.QuickTips.init();var x,f,s,D,h,c,B,t,a=0,e=1;var A=[];Ext.define("record",{extend:"Ext.data.Model",fields:["terId","name","terNum"]});var b=Ext.create("Ext.tip.ToolTip",{title:window.top.getIi18NText("systemMessage"),minWidth:100,html:""});function y(E,F){b.update(F);b.showBy(E,null,[50,-60]);E.addListener("mouseout",function(){b.hide()})}h={text:window.top.getIi18NText("operation"),minWidth:150,menuText:window.top.getIi18NText("operation"),menuDisabled:true,hidden:true,sortable:false,draggable:false,resizable:false,xtype:"actioncolumn",items:[]};if(true){h.items.push({iconCls:"editIconCss",tooltip:window.top.getIi18NText("modify"),handler:l});h.hidden=false}if(true){h.items.push({iconCls:"removeIconCss",tooltip:window.top.getIi18NText("delete"),handler:k});h.hidden=false}x=Ext.create("Ext.container.Viewport",{layout:"border",renderTo:Ext.getBody(),border:false,style:"background:white",items:[{region:"north",height:40,width:400,hidden:true,id:"northContanier",layout:{type:"hbox",align:"middle",defaultMargins:{right:3}},bodyCls:"x_panel_backDD",items:[{xtype:"image",src:"",width:40,height:24,imgCls:"searchIconCss"},{fieldLabel:window.top.getIi18NText("name"),id:"searchTextId",xtype:"textfield",maxLength:50,width:250,labelWidth:30,emptyText:window.top.getIi18NText("searchByToy"),enforceMaxLength:true},{xtype:"datefield",fieldLabel:window.top.getIi18NText("beCreatedTimne"),labelWidth:80,width:260,id:"btime",name:"btime",emptyText:window.top.getIi18NText("startTime"),format:dateFormat},{xtype:"datefield",name:"etime",id:"etime",width:180,emptyText:window.top.getIi18NText("endTime"),format:dateFormat},{xtype:"button",id:"queryBut",iconCls:"queryIconCss",text:window.top.getIi18NText("select"),handler:g}]},{region:"center",border:false,layout:"fit",listeners:{render:p}}]});function p(E,F){c=getAjaxProxy({url:"terminal!getAllWarnSetting.action"});D=Ext.create("Ext.data.Store",{fields:["fid","fname","url","number","type","wid","wname"],buffered:false,autoLoad:true,pageSize:10,leadingBufferZone:50,proxy:{type:"ajax",url:"terminal!getAllWarnSetting.action",reader:{type:"json",root:"data",tiemout:30000,totalProperty:"totalCount"}},listeners:{}});s=Ext.create("Ext.grid.Panel",{title:window.top.getIi18NText("warnList"),iconCls:"tabIconCss",frame:false,store:D,frame:false,border:false,forceFit:true,columns:{items:[{text:window.top.getIi18NText("Noo"),minWidth:60,align:"center",xtype:"rownumberer"},{text:window.top.getIi18NText("Noo"),dataIndex:"fid",hidden:true},{text:window.top.getIi18NText("wechat"),dataIndex:"url",sortable:false,renderer:function(L,G,H,J,N,M,K){var I=Ext.String.format('<img src="{0}" width="64px" height="64px" style="float:left"/>',L);var O=H.get("fname");return I+'<br><p style="float:left">'+O+"</p><br><br>"}},{text:window.top.getIi18NText("officialAccounts"),dataIndex:"wname"},{text:window.top.getIi18NText("type"),dataIndex:"type",renderer:q},{text:window.top.getIi18NText("Noo"),dataIndex:"url",hidden:true},{text:window.top.getIi18NText("warnTerNum"),sortable:false,dataIndex:"number"},h],defaults:{menuDisabled:true,draggable:false,align:"center"}},bbar:[{id:"padingBar",xtype:"pagingtoolbar",store:D,border:false,displayInfo:true}],margin:1,tools:[{xtype:"button",tooltip:window.top.getIi18NText("addWarn"),tooltipType:"title",text:window.top.getIi18NText("addWarn"),border:false,iconCls:"addIconCss",margin:"0 5 0 0",handler:d},{xtype:"button",text:window.top.getIi18NText("refresh"),border:false,iconCls:"refreshIconCss",handler:g}],viewConfig:{trackOver:false,disableSelection:false,emptyText:'<h1 style="margin:10px">'+window.top.getIi18NText("roleTip05")+"</h1>"}});E.add(s)}function g(E){D.loadPage(1)}var u=Ext.create("Ext.data.Store",{fields:["id","name"],autoLoad:true,proxy:{type:"ajax",url:"auth!allWepublic.action",extraParams:{start:0,limit:100,b:"",e:"",name:""},reader:{type:"json",root:"data",tiemout:20000,totalProperty:"totalCount"}},listeners:{load:function(){}}});var w=Ext.create("Ext.data.Store",{fields:["fid","fname"],autoLoad:true,proxy:{type:"ajax",url:"terminal!getAllWechatFans.action",reader:{type:"json",root:"data",tiemout:20000,totalProperty:"totalCount"}},listeners:{load:function(){}}});var r=Ext.create("Ext.data.Store",{fields:["terId","name","terNum"],buffered:false,autoLoad:true,pageSize:10,leadingBufferZone:50,proxy:{type:"ajax",url:"terminal!getAllTerminal.action",extraParams:{t:-1,g:-1,w:1,a:0},reader:{type:"json",root:"data",tiemout:30000,totalProperty:"totalCount"}},listeners:{load:function(F){var E=[];F.each(function(H){var G=H.data.terId;t.each(function(I){if(I.get("terId")==G){E.push(H)}});m.select(E,true)})}}});t=Ext.create("Ext.data.Store",{fields:["terId","name","terNum"],buffered:false,autoLoad:true,leadingBufferZone:50,proxy:{type:"ajax",url:"terminal!getTerminalByFid.action",extraParams:{fid:a,t:e},reader:{type:"json",root:"data",tiemout:30000,totalProperty:"totalCount"}},listeners:{load:function(E){E.each(function(F){var G=Ext.create("record",{terId:F.data.terId,name:F.data.name,terNum:F.data.terNum});A.push(G)});Ext.getCmp("showSelected").setValue(E.totalCount)}}});var v=new Ext.util.MixedCollection();var m=Ext.create("Ext.selection.CheckboxModel",{listeners:{select:C}});function C(I,G){if(!v.contains(G.get("terId"))){v.add(G.get("terId"),G)}var F=true;var J;for(var H=0;H<A.length;H++){if(A[H].get("terId")==G.get("terId")){F=false;break}}if(F){J=Ext.create("record",{terId:G.get("terId"),name:G.get("name"),terNum:G.get("terNum")});A.push(J);j.getStore().removeAll();j.getStore().add(A);var E=A.length;Ext.getCmp("showSelected").setValue(E)}}var n=Ext.create("Ext.grid.Panel",{store:r,height:300,width:400,selType:"checkboxmodel",selModel:m,forceFit:true,columns:[{text:getIi18NText("No"),width:60,xtype:"rownumberer",align:"center"},{text:getIi18NText("No"),dataIndex:"terId",hidden:true,width:75,menuDisabled:true,sortable:false,draggable:false},{text:getIi18NText("serNu"),dataIndex:"terNum",width:80,menuDisabled:true,align:"center",sortable:false,draggable:false},{text:getIi18NText("name"),dataIndex:"name",align:"center",width:158,align:"center",menuDisabled:true,sortable:false,draggable:false}],bbar:[{xtype:"pagingtoolbar",store:r,border:false,displayMsg:getIi18NText("confirm")=="OK"?"total:{2}":"共{2}条",displayInfo:true}],viewConfig:{trackOver:false,disableSelection:false,emptyText:'<h1 style="margin:10px">'+window.top.getIi18NText("roleTip05")+"</h1>"}});var j=Ext.create("Ext.grid.Panel",{store:t,height:300,width:245,selType:"checkboxmodel",forceFit:true,columns:[{text:getIi18NText("No"),dataIndex:"terId",hidden:true,width:75,menuDisabled:true,sortable:false,draggable:false},{text:getIi18NText("serNu"),dataIndex:"terNum",width:90,menuDisabled:true,align:"center",sortable:false,draggable:false},{text:getIi18NText("name"),dataIndex:"name",align:"center",width:140,menuDisabled:true,sortable:false,draggable:false}],bbar:[{id:"showSelected",xtype:"displayfield",fieldLabel:getIi18NText("checked"),value:0,labelWidth:50,width:100},{xtype:"tbfill"},{xtype:"button",margin:"0 20 0 10",text:getIi18NText("delete"),align:"right",border:true,handler:function(){var J=[];var H=[];var I=[];J=j.getSelectionModel().getSelection();if(J.length==0){return}for(var G=0;G<J.length;G++){for(var F=0;F<A.length;F++){if(A[F].get("terId")!=J[G].get("terId")){H.push(A[F]);I.push(A[F])}}A=new Array();A=H;H=new Array();v.removeAtKey(J[G].get("terId"))}r.loadPage(1);j.getStore().removeAll();j.getStore().add(A);var E=A.length;Ext.getCmp("showSelected").setValue(E)}}]});function k(F,H,K,G,I,E,J){Ext.Msg.show({icon:Ext.MessageBox.QUESTION,title:window.top.getIi18NText("systemMessage"),cls:"msgCls",msg:window.top.getIi18NText("confirm_del","<font color=red>"+E.get("fname")+"</font>"),animateTarget:J,plain:true,buttons:Ext.MessageBox.OKCANCEL,buttonText:{ok:getIi18NText("delete"),cancel:getIi18NText("cancel")},fn:function(L,N,M){if(L=="ok"){Ext.getBody().mask(getIi18NText("deling"));Ext.Ajax.request({url:"terminal!deleteWarn.action",params:{wid:E.get("fid"),t:E.get("type")},method:"post",callback:function(Q,R,P){var O=showResult(R,P);Ext.getBody().unmask();if(O==false){return}g();Ext.example.msg(window.top.getIi18NText("operationTips"),window.top.getIi18NText("deleteFileSuccess"))}})}}})}function l(F,H,K,G,I,E,J){d(J,E.get("fid"),E)}function d(G,I,E){a=I;A=new Array();var F=function(){a=0;t.getProxy().extraParams.fid=a;t.loadPage(1);Ext.getCmp("showSelected").setValue(0);v.removeAll();j.getStore().removeAll();j.getStore().add(A);Ext.getCmp("toyRoom").setValue(null);Ext.getCmp("wechatPublics_combo").setValue(null);var J=Ext.getCmp("toyType").items;J.each(function(M,L,K){M.setValue(false)});Ext.getCmp("toyRoom").setDisabled(false);Ext.getCmp("wechatPublics_combo").setDisabled(false);Ext.getCmp("toyType").setDisabled(false);B.hide(G)};var H=function(){Ext.getCmp("showSelected").setValue(0);B.setTitle(getIi18NText("addWarn"));if(/^\d+$/.test(I)){B.setTitle(getIi18NText("updateWarn"));i(E)}r.loadPage(1)};if(B&&B.isWindow){B.clearListeners();B.addListener("beforeclose",F);B.addListener("show",H);B.show(G);return}B=Ext.create("Ext.window.Window",{title:getIi18NText("addWarn"),plain:true,width:740,height:470,minWidth:200,minHeight:200,border:false,frame:false,resizable:false,modal:true,constrain:true,closeAction:"hide",layout:"fit",bodyCls:"x_panel_backDD",items:[{xtype:"form",width:"100%",height:"100%",monitorValid:true,border:false,items:[{xtype:"panel",layout:"column",border:false,items:[{xtype:"combo",id:"wechatPublics_combo",fieldLabel:'<font color="red"> * </font>'+getIi18NText("wechatName"),editable:false,margin:"5 0 0 20",labelWidth:getIi18NText("confirm")=="OK"?90:70,width:220,value:"",displayField:"name",valueField:"id",store:u,emptyText:getIi18NText("selectWechatPublic"),allowBlank:false,listeners:{change:function(N,M,J,K){var L={wid:M};w.proxy.extraParams=L;w.reload();Ext.getCmp("toyRoom").setValue("")}}},{xtype:"combo",id:"toyRoom",editable:false,margin:"5 0 0 20",width:150,value:"",displayField:"fname",valueField:"fid",store:w,emptyText:getIi18NText("selectWechatTips"),allowBlank:false,listeners:{change:function(M,L,J,K){}}}]},{xtype:"panel",layout:"column",border:false,items:[{xtype:"checkboxgroup",id:"toyType",border:false,fieldLabel:'<font color="red"> * </font>'+getIi18NText("warnType"),columns:4,vertical:true,width:"95%",margin:"5 0 0 20",labelWidth:70,defaults:{name:"type",margin:"0 20 0 0"},items:[{boxLabel:getIi18NText("warnType1"),id:"1",inputValue:"1",checked:false},{boxLabel:getIi18NText("warnType2"),id:"2",inputValue:"2",checked:false},{boxLabel:getIi18NText("transactionNotification"),id:"4",inputValue:"4",checked:false},{boxLabel:getIi18NText("offlineNotification"),id:"5",inputValue:"5",checked:false}]}]},{xtype:"panel",layout:{type:"hbox",align:"middle",pack:"center"},border:false,defaults:{margin:"10 0 0 10"},items:[{xtype:"fieldset",title:"<strong>"+getIi18NText("noChoose")+"</strong>",width:425,height:330,items:[n]},{xtype:"fieldset",title:"<strong>"+getIi18NText("checkedTerminals")+"</strong>",width:270,height:330,items:[j]}]},{xtype:"panel",border:false,items:[{xtype:"button",text:getIi18NText("cancel"),margin:"5 0 0 300",border:true,handler:function(){B.close();g}},{xtype:"button",text:getIi18NText("save"),formBind:true,margin:"5 0 0 20",border:true,handler:o}]}]}],listeners:{beforeclose:F,show:H}}).show(G)}function o(H){var I=Ext.getCmp("toyRoom").getValue();var J=Ext.getCmp("toyType").getValue().type;if(J==undefined){y(Ext.getCmp("toyType"),'<font color="red">'+getIi18NText("noChooseWarn")+"</font>");return}if(A.length==0){y(H,'<font color="red">'+getIi18NText("noChoose")+"</font>");return}if(J.length==1){var G=J}else{var G=J.join(",")}var K;var E=new Array();for(var F=0;F<A.length;F++){E.push(A[F].get("terId"))}K=E.join(",");Ext.getBody().mask(getIi18NText("saving"));Ext.Ajax.request({url:"terminal!saveWarn.action",method:"post",params:{wid:I,tids:K,t:G},timeout:30000,callback:function(N,O,M){var L=showResult(O,M);Ext.getBody().unmask();if(L==false){return}Ext.example.msg(window.top.getIi18NText("operationTips"),getIi18NText("saveSuccess"));B.close();g()}})}function i(F){a=F.get("fid");e=F.get("type");Ext.getCmp("toyRoom").setValue(F.get("fid"));Ext.getCmp("wechatPublics_combo").setValue(F.get("wid"));Ext.getCmp("toyRoom").setValue(F.get("fid"));var E=Ext.getCmp("toyType").items;if(typeof(E.get(e))!="undefined"){E.get(e).setValue(true)}Ext.getCmp("toyRoom").setDisabled(true);Ext.getCmp("wechatPublics_combo").setDisabled(true);Ext.getCmp("toyType").setDisabled(true);t.getProxy().extraParams.fid=a;t.getProxy().extraParams.t=e;t.loadPage(1)}function q(E){if(E=="1"){return'<font color="green">'+getIi18NText("warnType1")+"</font>"}else{if(E=="2"){return'<font color="blue">'+getIi18NText("warnType2")+"</font>"}else{if(E=="5"){return'<font color="red">'+getIi18NText("offlineNotification")+"</font>"}else{if(E=="4"){return'<font color="orange">'+getIi18NText("transactionNotification")+"</font>"}}}}}function z(E){return Ext.Date.format(new Date(E),dateFormat)}});