Ext.Loader.setConfig({enabled:true,paths:{"Ext.ux.DataView":"js/ext/examples/ux/DataView/"}});var modifySubRemote,showTerminalDetail,remoRemote,goRemote,isFreshing=true,isPlanfresh=false;Ext.onReady(function(){Ext.getBody().mask(getIi18NText("loadingInfo"));Ext.QuickTips.init();var v,w,f="sort_0_name_ASC",i="view_ul",p,a="terA_view";var o=true,b;var t=Ext.merge({screen:false,off:false,"delete":false,play:false,pub:false,restart:false},Ext.decode(decode(AUTH_TBAR)));v=Ext.create("Ext.container.Viewport",{layout:"border",renderTo:document.body,border:false,style:"background: white",items:[{region:"north",height:40,width:400,id:"northContanier",layout:{type:"hbox",align:"middle",defaultMargins:{right:3}},bodyCls:"x_panel_backDD",items:[{xtype:"image",src:"",width:40,height:24,imgCls:"searchIconCss",},{fieldLabel:getIi18NText("name"),id:"searchTextId",xtype:"textfield",maxLength:50,width:130,labelWidth:30,emptyText:getIi18NText("keyword"),enforceMaxLength:true,listeners:{change:k}},{xtype:"label",html:"&nbsp;&nbsp;"+getIi18NText("operation")+":&nbsp;",hidden:true},{xtype:"button",iconCls:"addRemoteIconCss",id:"addServerBtn",text:getIi18NText("add"),handler:function(){n()}},{xtype:"button",iconCls:"refreshIconCss",text:getIi18NText("refresh"),handler:function(){r()}},{xtype:"checkbox",boxLabel:getIi18NText("autoRefresh"),checked:false,inputValue:1,id:"autoFreshCheckbox"}],listeners:{afterrender:function(){if(!t.addCluster){Ext.getCmp("addServerBtn").setVisible(false)}}}},{region:"center",xtype:"fieldset",title:getIi18NText("cluster_remoteList"),margin:"0 3 3 1",id:"imgCenterArea",layout:"fit",cls:"dropShadowCss",listeners:{resize:x}},{region:"south",xtype:"fieldset",id:"sortArea",layout:{type:"hbox",align:"middle",defaultMargins:{right:3}},margin:"10 0 0 0",height:35,items:[{xtype:"button",text:getIi18NText("prePage"),id:"firstButton",handler:function(){s("pre");r();q()}},{xtype:"numberfield",allBank:false,allowDecimals:false,allowNegative:false,id:"pageOfNext",fieldLabel:getIi18NText("currentPage"),margin:"0 0 0 4",labelWidth:40,maxWidth:110,hideTrigger:true,value:"1",listeners:{specialKey:function(A,z){if(z.getKey()==Ext.EventObject.ENTER){r();q()}}}},{xtype:"displayfield",id:"disTotalPage",fieldLabel:getIi18NText("totalPage"),labelWidth:25,value:"0"+getIi18NText("defaultPageCount")},{xtype:"displayfield",fieldLabel:getIi18NText("currentList"),margin:"0 0 0 4",labelWidth:60,},{xtype:"displayfield",id:"pageInfo",fieldLabel:"",margin:"0 10 0 4",labelWidth:100,value:"0-0"+getIi18NText("list")},{xtype:"displayfield",id:"imgTotalfield",fieldLabel:getIi18NText("cluster_totalRemoteCount"),margin:"0 0 0 4",labelStyle:"color: red",labelWidth:83,width:115,value:"0"},{xtype:"button",text:getIi18NText("nextPage"),id:"lastButton",handler:function(){s("next");r();q()}}],listeners:{}}]});function s(z){currentPage=Ext.getCmp("pageOfNext").getValue();if(z=="next"){Ext.getCmp("pageOfNext").setValue(parseInt(currentPage)+1)}else{Ext.getCmp("pageOfNext").setValue(currentPage-1)}}function q(){currentPage=Ext.getCmp("pageOfNext").getValue();var A=Ext.getCmp("firstButton");disTotalPage=Math.ceil(Ext.getCmp("imgTotalfield").getValue()/10);var z=Ext.getCmp("lastButton");if(currentPage==1||currentPage==0){A.setDisabled(true)}else{A.setDisabled(false)}if(currentPage==disTotalPage||disTotalPage==0||disTotalPage==1){z.setDisabled(true)}else{z.setDisabled(false)}}function g(){Ext.getCmp("pageOfNext").setValue(1)}var y=Ext.create("Ext.data.Store",{fields:[{name:"id",type:"int"},"name","ip","loginame","loginpwd","stateValue","imgsrc",],buffered:false,pageSize:10,leadingBufferZone:20,proxy:{type:"ajax",url:"system!clusterList.action",reader:{type:"json",root:"data",tiemout:20000,totalProperty:"totalCount"}},listeners:{load:function(z){Ext.getCmp("imgTotalfield").setValue(z.getTotalCount())}}});var d=[];d.push('<ul class="itemUl dropShadowCss ext_panel_backDD_ul">');d.push('  <tpl if="stateValue == 2">');d.push('   <li class="li_01 ext_panel_backConn">');d.push("  </tpl>");d.push('  <tpl if="stateValue == 3">');d.push('   <li class="li_01 ext_panel_backDisconn">');d.push("  </tpl>");d.push('	 <span class="span_name"><input value="{[values.name]}" class="tit" readOnly title="{[values.name]}"/></span>');if(t["delete"]){d.push('	 <span class="span_del removeIconCss" title="'+getIi18NText("remoRemote")+'"  onclick="remoRemote({[values.id]})">&nbsp;</span>')}d.push("  </li>");d.push('  <li class="li_02" > ');d.push('	    <table class="tab">');d.push("		    <tr>");d.push('			  <td style="text-align:center; vertical-align:middle;">');d.push('			   <img src="{[values.imgsrc]}" width="72px" height="72px" />');d.push("		      </td>");d.push("		   </tr>");d.push("		</table>");d.push('		<div class="hoverDiv_cover">&nbsp;</div>');d.push('		<div class="hoverDiv">');d.push("		</div>");d.push("  </li>");d.push('  <li class="li_03">');d.push('       <ul class="ulBut">');d.push('  <tpl if="stateValue == 2">');d.push("  </tpl>");d.push('  <tpl if="stateValue == 2">');d.push("  </tpl>");if(t.connect){d.push('	       <li ><a id="'+a+'{[values.id]}" href="javascript:goRemote({[values.id]});" class="ctrl_but goRemoteIconCss" title="'+getIi18NText("cluster_goRemote")+'"></a></li>')}if(t.update){d.push('	       <li ><a id="'+a+'{[values.id]}" href="javascript:modifySubRemote({[values.id]});" class="ctrl_but modifyRemoteIconCss" title="'+getIi18NText("cluster_modify")+'"></a></li>')}d.push("	   </ul>");d.push("  </li>");d.push("</ul>");var u=Ext.create("Ext.view.View",{store:y,tpl:Ext.create("Ext.XTemplate",'<tpl for=".">',d.join(""),"</tpl>"),id:"terminalId",itemSelector:"ul.itemUl",multiSelect:true,autoScroll:true,listeners:{}});function k(){window.clearTimeout(w);w=window.setTimeout(function(){r()},800)}function x(){if(Ext.getCmp("imgDataViewPanel")){}}Ext.getCmp("imgCenterArea").add({xtype:"panel",id:"imgDataViewPanel",header:false,border:false,layout:"fit",hidden:true,listeners:{afterrender:function(){this.add(u);r();this.show(null,function(){Ext.getBody().unmask()});if(o==true){window.setInterval(function(){if(c()==true&&Ext.getCmp("autoFreshCheckbox").getValue()==true){r()}},10000)}}}});var j;var e;function r(){isFreshing=false;var A=Ext.getCmp("searchTextId").getValue();var z=Ext.getCmp("pageOfNext").getValue();if(!isNaN(z)){if(z>e){Ext.getCmp("pageOfNext").setValue(e);z=e;if(z<=0){g();z=1}}else{if(z<=0){Ext.getCmp("pageOfNext").setValue(1);z=1}}}else{m(getIi18NText("pageError"),Ext.Msg.ERROR);return}y.load({params:{p:z,n:encode(A)},callback:function(D,C,G){if(G==false){isFreshing=false;return}isFreshing=true;j=y.getTotalCount();e=(j%10)!=0?parseInt(j/10)+1:j/10;Ext.getCmp("disTotalPage").setValue(e+getIi18NText("page")+"  ");var E=z*10,B=(10*(z-1)+1);if(E>j){E=j}if(E==0){B=0}if(e==0){tpl2=Ext.create("Ext.XTemplate",'<tpl for=".">',"<br/>",'<h1 style="color:#808080">{info}</h1>',"</tpl>");var F={info:getIi18NText("roleTip05")};tpl2.overwrite(Ext.get("terminalId"),F);Ext.getCmp("pageOfNext").setValue(0)}Ext.getCmp("pageInfo").setValue(B+"-"+E+getIi18NText("list"));q()}})}remoRemote=function(z){if(/^((\d*,)*\d+)|\d+$/.test(z)){z=Ext.isArray(z)?z.join(","):z;isFreshing=false;Ext.Msg.show({icon:Ext.MessageBox.QUESTION,title:getIi18NText("systemMessage"),cls:"msgCls",msg:getIi18NText("cluster_removRemote"),plain:true,buttons:Ext.MessageBox.OKCANCEL,buttonText:{ok:getIi18NText("monitor_message_55"),cancel:getIi18NText("monitor_message_32")},fn:function(A,C,B){if(A=="ok"){Ext.getBody().mask(getIi18NText("dataProcessing"));Ext.Ajax.request({url:"system!remoRemote.action",method:"post",params:{id:z},callback:function(F,G,E){isFreshing=true;var D=showResult(G,E);if(D==false){Ext.getBody().unmask();return}Ext.example.msg(getIi18NText("operationResultTip"),getIi18NText("cluster_removeSuccess"));Ext.getBody().unmask();r()}})}else{isFreshing=true}}})}};var c=function(){return(window.name==parent.nowTabName)&&(isFreshing==true)};function n(A,B){var z=function(){b.hide(A);b.down("form").getForm().reset();b.setTitle(window.top.getIi18NText("addSubRemote"))};var C=function(){Ext.getCmp("remoteId").setValue(B);if(/^\d+$/.test(B)){Ext.Ajax.request({url:"system!getRemoteInfo.action",params:{rid:B},callback:l})}};if(b&&b.isWindow){b.clearListeners();b.addListener("beforeclose",z);b.addListener("show",C);b.show(A);return}b=Ext.create("Ext.window.Window",{title:window.top.getIi18NText("addSubRemote"),plain:true,width:480,height:300,minWidth:200,minHeight:200,border:false,modal:true,constrain:true,closeAction:"hide",listeners:{beforeclose:z,show:C},layout:"fit",bodyCls:"x_panel_backDD",items:[{xtype:"form",layout:{type:"vbox",align:"center",pack:"center"},width:"100%",height:"100%",border:false,autoScroll:true,defaults:{labelAlign:"right",width:380,labelWidth:60},items:[{xtype:"textfield",inputType:"hidden",id:"remoteId",name:"remoteId"},{xtype:"textfield",fieldLabel:window.top.getIi18NText("remoteName"),id:"servName",name:"servName",maxLength:25,allowBlank:false,enforceMaxLength:true,blankText:window.top.getIi18NText("connectName"),emptyText:window.top.getIi18NText("connectName")},{xtype:"textfield",fieldLabel:"IP",id:"netUrl",name:"netUrl",maxLength:100,regex:/^[0-9a-zA-Z\.]+$/,regexText:window.top.getIi18NText("IPReeor"),allowBlank:false,enforceMaxLength:true,blankText:window.top.getIi18NText("cluster_ipOrAddress"),emptyText:window.top.getIi18NText("cluster_ipOrAddress")},{xtype:"numberfield",fieldLabel:window.top.getIi18NText("cluster_port"),id:"port",name:"port",maxLength:10,allowBlank:false,enforceMaxLength:true,value:"80"},{xtype:"textfield",fieldLabel:window.top.getIi18NText("username"),vtype:"alphanum",id:"loginName",name:"loginName",maxLength:100,allowBlank:false,blankText:getIi18NText("notNull"),emptyText:window.top.getIi18NText("cluster_enterLoingName")},{xtype:"textfield",fieldLabel:window.top.getIi18NText("password"),inputType:"password",id:"passWord",regex:/^[0-9a-zA-Z_]{6,18}$/,regexText:window.top.getIi18NText("passwordWarming01")+","+window.top.getIi18NText("passwordWarming02"),name:"passWord",maxLength:480,allowBlank:false,enforceMaxLength:true,emptyText:window.top.getIi18NText("cluster_enterPassWord")},{xtype:"fieldcontainer",layout:"hbox",fieldLabel:"&nbsp;",labelSeparator:"",items:[{xtype:"button",text:window.top.getIi18NText("testConnect"),formBind:true,disabled:true,margin:"5 0 0 0",width:window.top.getIi18NText("save")=="Save"?130:75,iconCls:"pback_finish_IconCls",handler:function(){h()}},{xtype:"button",text:window.top.getIi18NText("save"),formBind:true,disabled:true,margin:"5 0 0 5",width:75,iconCls:"pback_finish_IconCls",handler:addRemote},{xtype:"button",text:window.top.getIi18NText("cancel"),margin:"5 0 0 5",width:75,iconCls:"pback_reset_IconCls",handler:function(){b.close()}}]}]}]}).show(A)}addRemote=function(A,B){var z="system!addRemote.action";var C=Ext.getCmp("remoteId").getValue();if(C>0){z="system!modifySubRemote.action"}b.getEl().mask(window.top.getIi18NText("saving"));A.up("form").submit({url:z,submitEmptyText:false,success:function(D,E){b.getEl().unmask();if(E.result.code==0){Ext.example.msg(window.top.getIi18NText("operationResultTip"),window.top.getIi18NText("saveSuccess"));b.close();r()}else{Ext.Msg.alert(window.top.getIi18NText("systemMessage"),E.result.msg)}}})};function h(C,D){if(!D){b.getEl().mask(getIi18NText("cluster_connecting"))}var H,G,A,F,z,B;if(D==true){H=C.netUrl;G=C.loginName;A=C.passWord;z=C.port;F="connect"}else{H=Ext.getCmp("netUrl").getValue();z=Ext.getCmp("port").getValue();G=Ext.getCmp("loginName").getValue();A=Ext.getCmp("passWord").getValue();F="test"}H="http://"+H;if(z!="80"){H+=":"+z}var E=H+"/Digital/auth!loginUser.action";Ext.data.JsonP.request({url:E,timeout:60000,params:{n:G,p:A,t:F},success:function(I){Ext.getBody().unmask();if(!D){b.getEl().unmask()}if(I.code=="0"){if(D){window.open(H+"/Digital/auth!indexPage.action");return}m(getIi18NText("connectSuccess"),Ext.Msg.INFO)}else{m(getIi18NText("connectFaild"),Ext.Msg.ERROR)}},failure:function(I){if(!D){b.getEl().unmask()}m(getIi18NText("remoteNoResponse"),Ext.Msg.ERROR);Ext.getBody().unmask();return}})}function m(A,z){Ext.Msg.show({title:getIi18NText("upload_tip_tip"),msg:A,width:250,icon:z,buttons:Ext.Msg.OK,buttonText:{ok:getIi18NText("confirm")}})}function l(B,E,A){if(A.responseText==""||A.responseText=="null"){m(getIi18NText("cluster_getDataFail"),Ext.Msg.ERROR);b.close();return}var z;try{z=Ext.decode(A.responseText)}catch(D){Ext.Msg.alert(getIi18NText("systemMessage"),getIi18NText("loginTimeoutTip01"),function(){window.location.replace("auth!logOffUser.action")});return false}var C=z.data;if(C==null){m(getIi18NText("cluster_getDataFail"),Ext.Msg.ERROR);b.close();return}b.setTitle(getIi18NText("modifyRemote"));Ext.getCmp("remoteId").setValue(C.id);Ext.getCmp("servName").setValue(C.servName);Ext.getCmp("netUrl").setValue(C.netUrl);Ext.getCmp("loginName").setValue(C.loginName);Ext.getCmp("passWord").setValue(C.passWord);Ext.getCmp("port").setValue(C.port)}modifySubRemote=function(z){n(null,z)};goRemote=function(B){Ext.getBody().mask(getIi18NText("cluster_connecting"));var A;var z;Ext.Ajax.request({url:"system!getRemoteInfo.action",params:{rid:B},success:function(D){if(D.responseText==""||D.responseText=="null"){m(getIi18NText("cluster_getDataFail"),Ext.Msg.ERROR);Ext.getBody().unmask();return}var C=Ext.decode(D.responseText);A=C.data;if(A==null){m(getIi18NText("cluster_getDataFail"),Ext.Msg.ERROR);Ext.getBody().unmask();return}z=A.netUrl;h(A,true)},failure:function(C){m(getIi18NText("openConnectFaild"),Ext.Msg.ERROR);Ext.getBody().unmask()}})}});